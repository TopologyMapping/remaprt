\section{Remapping Routing Events}
\label{sec:patching}

Routing events impact multiple paths in the Internet. Current
monitoring techniques monitor paths independently: detecting
a routing event on one Internet paths does not trigger any action on
other possibly-impacted paths.  This approach leads to outdated
routing information (as we do not remap other paths that have 
changed due to the routing event) and prevents us from
observing the extent of a routing event (as another routing event
might happen before we remap all routes impacted by the first event).
In this section we investigate whether we can use information about
a just-remapped change to efficiently (using few probes) detect and remap changes the
underlying routing event caused on other paths.  

%Our goal is to
%develop techniques to efficiently (using few probes) identify and
%remap paths impacted by a routing event.

\newcommand{\lczd}{\ensuremath\mathrm{\textsc{lczd}}}

We define a \emph{local change zone domain}, denoted $\lczd(r')$,
for a change detected at radius $r'$ as the hops removed from the
previous path, $p_{i-1}$, around $r'$ plus the surrounding divergence
and convergence hops. 
More formally, if $r_d$ and
$r_c$ are the radii of the divergence and convergence hops,
respectively, and if $r^\prime_d = p_{i-1}\langle p[r_d]\rangle$ and
$r^\prime_c = p_{i-1}\langle p[r_c]\rangle$ are the radii of the
divergence and convergence hops on the previous path, then
$\lczd(r')$ is defined as the set of hops in $p_{i-1}$ between
$r^\prime_d$ and $r^\prime_c$, i.e., $\lczd(r') = \{p_{i-1}[x]
\mid{} r^\prime_d \le x \le r^\prime_c\}$.

We extended \dtrack{} to collect data to study techniques for remapping paths
after detection of a routing event.  Upon detecting a path change at
radius $r'$ on path $p_{i-1}$ (i.e., $p[r'] \ne p_{i-1}[r']$),
\dtrack{} immediately queues path $p_{i-1}$ to be remapped
(remapping starts immediately if there are no ongoing remaps).
After remapping of path $p_{i-1}$ is complete, our extended \dtrack{} computes
$\lczd(r')$ and queues all (other)
\emph{overlapping paths} $q$ who intersect $\lczd(r')$, i.e., $q\,
\cap\,\lczd(r') \ne \emptyset$, for remapping (if not already queued).
Let us denote the a routing event by $E(p_{i-1})$ 
and let $D(E(p_{i-1}))$ be the time spent to remap all overlapping routes.

%interval starting from the detection of the routing event
%until the ending of the remapping of the last \emph{overlapping path}
%originated by $E_p$.
If an \emph{overlapping path} $q$ enqueued by some $E_p$ changed, we do not consider
it as a new routing event as it can overlap and enqueue path $p$ during
$D(E(p_{i-1}))$. If paths $p$ and $q$ change over time, the routing event $E_p$
may never end. Also, we set a minimum time interval between routing events for a same
destination to avoid an unstable path $p$ being detected as a routing event
frequently and flood the remapping queue.

We deployed the extended \dtrack{} on 80 PlanetLab nodes using three 
sources of destinations: TOP100 Alexa,  RIPE Atlas probes, and reachable
/24 prefixes. The total number of IP addresses were 12763 with a coverage of 5715 ASes 
using the IP to AS mapping from iPlane database. For each PlanetLab node, we
selected 1000 random IP addresses to be monitored, allowing repetition among these IP 
addresses across nodes. The data used in this analysis was colleted between 01/27/2016 
and 03/07/2016, i.e., 40 days.

\begin{figure*}
\vspace{5mm}
\begin{minipage}{0.32\textwidth}
\includegraphics[width=1.05\columnwidth]{figs/patching/durationdetection/durationdetection.eps}
\caption{CDF of $D(E(p_{i-1}))$ of all $E(p_{i-1})$.}
\label{fig:overlap.delay.cdf}
%
\end{minipage}
\hfill
\begin{minipage}{0.32\textwidth}
\includegraphics[width=1.05\columnwidth]{figs/patching/routesoverlapping/routesoverlapping.eps}
\caption{CDF of detection overlapping with other routes.}
\label{fig:overlap.quantity.cdf}
\end{minipage}
%
\hfill
\begin{minipage}{0.32\textwidth}
\includegraphics[width=1.05\columnwidth]{figs/patching/probchange/probchange.eps}
\caption{Probability of a overlapping path changes given the size of the overlap.}
\label{fig:overlap.change.prob}
\end{minipage}
\end{figure*}


Figure~\ref{fig:overlap.delay.cdf} shows the CDF, over all $E(p_{i-1})$, 
of the time it takes to remap all
overlapping routes ($D(E(p_{i-1}))$) grouped in 5-minute intervals.  
Because we remap overlapping paths within
a short period, there is a lower probability that subsequent routing
events will happen while the remap is ongoing.
Figure~\ref{fig:overlap.quantity.cdf} shows the CDF, over all
detected path changes, of the fraction of overlapping paths in $E(p_{i-1})$,.  
We observe that 74\% of all routes have at least one 
\emph{overlapping path} which leads us to investigate further if these
paths also change.
As described in Section~\ref{sec:char}, a path can have more than one
change. This means that if $E(p_{i-1})$, has more than one $\lczd$, the \emph{overlapping
paths} can cross different parts of $E(p_{i-1})$,. Thus, we can divide $E(p_{i-1})$, in a more
fine-grained parts ($\lczd$) which can explain better the behaviour of changes in
\emph{overlapping paths}. For the rest of this section, we
consider each $\lczd$ in $E(p_{i-1})$ independently. 

Let $O$ denote the overlap between an \emph{overlapping path} $q$ and a 
$E(p_{i-1})$, i.e., $O = \lczd,\cap\,q$. The next step 
is to analyze whether an \emph{overlapping path} changes given $O$.
Figure~\ref{fig:overlap.change.prob} shows
the fraction of overlapping paths that have changed as well, grouping
\emph{overlapping paths} by the fraction of the \emph{overlapping path}
that overlaps the $\lczd$ in $E(p_{i-1})$, i.e.,
$|O|\div|\lczd|$.  We note that as overlapping paths
have more in common with the local change zone domain, the higher
the probability that the overlapping path will change. 

We now want to find a way to identify whether an \emph{overlapping path}
has changed (or remained stable). As pointed out before, a path change can have more
than one $\lczd$ and we treat each of them independently in $E_p$.
We now formalize how we consider this fact inside \emph{overlapping paths}.
Let $\lczd'$ denote the local change zone domain of an \emph{overlapping path}
without $r_d$ and $r_c$ if $|\lczd'_{p}| = |\lczd'_{p-1}|$, i.e.,
$\lczd'$ is the set of hops that reveal changes if probed. We define the
overlapping change set $OCS = \bigcup(\lczd')$ as the set of all hops in the
\emph{overlapping path} where a probe can detect a change.
We also define the Candidate Probing Set ($CPS$) as the subpath 
in the \emph{overlapping path} $q$ between the \emph{first} and \emph{last} 
hop in $O$, i.e., a set of hops related to $E(p_{i-1})$ which we want to analyze
to determine if $q$ has changed. We show the effectiveness of $r_d$ and $r_c$ 
from $E(p_{i-1})$ in detect changes in \emph{overlapping path} $q$, i.e.,
$E(p_{i-1})[r_d] \cap OCS$ and $E(p_{i-1})[r_c] \cap OCS$ reveals that in 99.56\% of times 
$E(p_{i-1})[r_d] \cap OCS = \emptyset$ and in 91.12\% $E(p_{i-1})[r_c] \cap OCS = \emptyset$.
For this reason, we exclude the $E(p_{i-1})[r_d]$ and $E(p_{i-1})[r_c]$ from
$CPS$.

Analyzing all 67 million overlaps found, 66\% of cases the \emph{overlapping paths}
that does not have any change ($OCS = \emptyset$) and 4,83\% of overlaps have 
$OCS \ne \emptyset$ but $CPS \cap OCS = \emptyset$, 
i.e., we are not able to detect a change in the \emph{overlapping path}
based on $CPS$. 
We now focus on the 29.07\% of overlaps such that $CPS \cap OCS \ne \emptyset$
where we can make a contribution. Figure~\ref{fig:lczd.intersection}  
shows the distribution of the fraction of hops in $CPS$ that are in a $OCS$.  The distribution shows that,
in 96.70\% of overlaps where $CPS \cap OCS \ne \emptyset$, probing any hop inside $CPS$ 
will detect a change.

%We also looked
%at where the intersection $I$ is located compared to $\lczd$.  We
%find that XX\% of the intersections $I$ are at the start of the
%local change zone (i.e., $r_d + 1$), YY\% of the intersections $I$
%are at the end of the local change zone (i.e., $r_c - 1$), and that
%only ZZ\% of the intersections do are in neither extreme of the
%change zone.


\begin{figure}
\begin{center}
\includegraphics[width=0.8\columnwidth]{figs/patching/overlapcoverage/overlapcoverage_only_lczd.eps}
\caption{Probability of a probe inside a $CPS$ detect a change if $CPS \cap C \ne \emptyset$.}
\label{fig:lczd.intersection}
\end{center}
%
\end{figure}
